<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Scheduler</title>
    <style>
        /* --- CSS STYLES --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: #f4f7f6;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.08);
            overflow: hidden;
            min-height: 80vh; /* Taller container for week/day views */
            display: flex;
            flex-direction: column;
        }

        /* --- HEADER --- */
        .header {
            padding: 20px;
            background: #007bff;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header-left { display: flex; align-items: center; gap: 20px; }
        
        /* Navigation Buttons */
        .btn-nav {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            margin-left: 5px;
        }
        .btn-nav:hover { background: rgba(255,255,255,0.3); }
        .btn-nav.active { background: white; color: #007bff; font-weight: bold; }
        
        /* Associate Button - distinct style */
        .btn-associate {
            background: #ffc107; /* Yellow/Gold */
            color: #333;
            font-weight: bold;
        }
        .btn-associate:hover { background: #e0a800; }

        .month-nav { display: flex; align-items: center; gap: 15px; }
        .month-nav button {
            background: none; border: 1px solid white; color: white;
            padding: 8px 12px; border-radius: 6px; cursor: pointer;
        }
        #currentDateDisplay {
            font-size: 1.5rem; font-weight: 600; width: 280px; text-align: center;
        }

        /* --- CALENDAR GRIDS --- */
        /* Header Row (Sun, Mon...) */
        #calendar-headers {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            background: #f9f9f9;
            border-bottom: 1px solid #ddd;
        }
        .day-header {
            text-align: center; padding: 12px 0; font-weight: bold;
            border-left: 1px solid #ddd;
        }
        .day-header:first-child { border-left: none; }

        /* Main Content Area */
        #calendar {
            flex-grow: 1; /* Fill remaining space */
            display: grid;
            /* Default to 7 columns (Month/Week), JS changes this for Day view */
            grid-template-columns: repeat(7, 1fr); 
        }

        /* Cells */
        .day-cell {
            border-bottom: 1px solid #ddd;
            border-left: 1px solid #ddd;
            padding: 8px;
            cursor: pointer;
            min-height: 120px;
        }
        .day-cell:hover { background-color: #eef8ff; }
        .day-cell.other-month { background-color: #fafafa; color: #ccc; }
        .day-number { font-weight: bold; margin-bottom: 5px; }

        /* Week View Specifics */
        .week-view .day-cell { min-height: 400px; } /* Taller columns */

        /* Day View Specifics */
        .day-view #calendar { grid-template-columns: 1fr; } /* Single column */
        .day-view .day-cell { min-height: 500px; border-left: none; }

        /* --- EVENTS --- */
        .event {
            font-size: 13px; padding: 4px 8px; border-radius: 4px;
            margin-top: 4px; color: white; cursor: pointer;
            display: flex; justify-content: space-between;
        }
        .event-pto { background-color: #ff9800; }
        .event-shift { background-color: #4caf50; }
        .event-sick { background-color: #f44336; }

        /* --- MODALS --- */
        .modal-backdrop {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); display: none;
            justify-content: center; align-items: center; z-index: 1000;
        }
        .modal-content {
            background: white; padding: 25px; border-radius: 8px; width: 400px;
        }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-group input, .form-group select {
            width: 100%; padding: 10px; border: 1px solid #ccc;
            border-radius: 4px; box-sizing: border-box;
        }
        .modal-buttons { display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px; }
        .modal-buttons button { padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; }
        .btn-save { background: #007bff; color: white; }
        .btn-cancel { background: #ccc; }
        .btn-delete { background: #f44336; color: white; margin-right: auto; }

        /* Associate Manager Specifics */
        #associateList {
            list-style: none; padding: 0; margin-bottom: 20px;
            max-height: 200px; overflow-y: auto; border: 1px solid #eee;
        }
        #associateList li {
            padding: 10px; border-bottom: 1px solid #eee;
            display: flex; justify-content: space-between; align-items: center;
        }
        .btn-sm-delete {
            background: #ffdddd; color: #d00; border: none;
            border-radius: 4px; padding: 4px 8px; cursor: pointer; font-size: 12px;
        }

    </style>
</head>
<body>

    <div class="container" id="mainContainer">
        <div class="header">
            <div class="header-left">
                <div class="month-nav">
                    <button id="prevBtn">◄</button>
                    <div id="currentDateDisplay"></div>
                    <button id="nextBtn">►</button>
                </div>
            </div>
            <div class="header-nav">
                <button class="btn-nav active" onclick="switchView('month')" id="btnMonth">Monthly</button>
                <button class="btn-nav" onclick="switchView('week')" id="btnWeek">Weekly</button>
                <button class="btn-nav" onclick="switchView('day')" id="btnDay">Daily</button>
                <button class="btn-nav btn-associate" id="btnManageAssociates">Associates</button>
            </div>
        </div>

        <div id="calendar-headers"></div>

        <div id="calendar"></div>
    </div>

    <div id="eventModal" class="modal-backdrop">
        <div class="modal-content">
            <h2 id="modalTitle">Add Schedule</h2>
            <form id="eventForm">
                <input type="hidden" id="eventDate">
                <input type="hidden" id="eventId">

                <div class="form-group">
                    <label>Associate</label>
                    <select id="associateSelect" required>
                        </select>
                </div>

                <div class="form-group">
                    <label>Event Type</label>
                    <select id="eventType">
                        <option value="shift">Work Shift</option>
                        <option value="pto">PTO (Time Off)</option>
                        <option value="sick">Sick Day</option>
                    </select>
                </div>

                <div id="timeFields">
                    <div class="form-group">
                        <label>Start Time</label>
                        <input type="time" id="startTime">
                    </div>
                    <div class="form-group">
                        <label>End Time</label>
                        <input type="time" id="endTime">
                    </div>
                </div>

                <div class="modal-buttons">
                    <button type="button" id="deleteBtn" class="btn-delete">Delete</button>
                    <button type="button" id="cancelBtn" class="btn-cancel">Cancel</button>
                    <button type="submit" class="btn-save">Save</button>
                </div>
            </form>
        </div>
    </div>

    <div id="associateModal" class="modal-backdrop">
        <div class="modal-content">
            <h2>Manage Team</h2>
            <p style="font-size: 14px; color: #666;">Add your team members here. To set PTO or Availability, simply add those as events on the calendar.</p>
            
            <ul id="associateList"></ul>

            <div class="form-group" style="display: flex; gap: 10px;">
                <input type="text" id="newAssociateName" placeholder="Enter name (e.g. Zachary)">
                <button type="button" id="btnAddAssociate" class="btn-save" style="width: 100px;">Add</button>
            </div>

            <div class="modal-buttons">
                <button type="button" id="closeAssociateBtn" class="btn-cancel">Close</button>
            </div>
        </div>
    </div>

    <script>
        // --- STATE ---
        let navDate = new Date(); 
        let currentView = 'month'; // 'month', 'week', 'day'
        let events = []; 
        
        // Default Associates
        let associates = ['Zachary', 'Cindy', 'Manager'];

        let currentlyEditingEventId = null;

        // --- DOM ELEMENTS ---
        const mainContainer = document.getElementById('mainContainer');
        const calendarGrid = document.getElementById('calendar');
        const calendarHeaders = document.getElementById('calendar-headers');
        const currentDateDisplay = document.getElementById('currentDateDisplay');
        
        // Event Modal
        const eventModal = document.getElementById('eventModal');
        const eventForm = document.getElementById('eventForm');
        const associateSelect = document.getElementById('associateSelect');
        
        // Associate Modal
        const associateModal = document.getElementById('associateModal');
        const associateListEl = document.getElementById('associateList');
        const newAssociateInput = document.getElementById('newAssociateName');

        // --- INITIALIZATION ---
        function init() {
            renderAssociates(); // Fill the dropdown
            render(); // Draw the calendar
        }

        // --- VIEW SWITCHING LOGIC ---
        function switchView(view) {
            currentView = view;
            // Update button styles
            document.querySelectorAll('.header-nav .btn-nav').forEach(b => b.classList.remove('active'));
            if(view === 'month') document.getElementById('btnMonth').classList.add('active');
            if(view === 'week') document.getElementById('btnWeek').classList.add('active');
            if(view === 'day') document.getElementById('btnDay').classList.add('active');
            
            render();
        }

        // --- RENDER CONTROLLER ---
        function render() {
            // Clear styles from container that might be leftover
            mainContainer.className = 'container';
            
            if (currentView === 'month') {
                renderMonthView();
            } else if (currentView === 'week') {
                mainContainer.classList.add('week-view');
                renderWeekView();
            } else if (currentView === 'day') {
                mainContainer.classList.add('day-view');
                renderDayView();
            }
        }

        // --- 1. MONTH VIEW RENDERER ---
        function renderMonthView() {
            calendarGrid.innerHTML = '';
            calendarHeaders.innerHTML = '';
            calendarGrid.style.gridTemplateColumns = 'repeat(7, 1fr)';
            calendarHeaders.style.gridTemplateColumns = 'repeat(7, 1fr)';

            const year = navDate.getFullYear();
            const month = navDate.getMonth();
            
            currentDateDisplay.innerText = navDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });

            // Headers
            ['Sat', 'Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri'].forEach(d => {
                calendarHeaders.innerHTML += `<div class="day-header">${d}</div>`;
            });

            const firstDayIndex = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const prevMonthDays = new Date(year, month, 0).getDate();

            for (let i = 0; i < 42; i++) {
                const cell = document.createElement('div');
                cell.className = 'day-cell';
                let cellDateStr;

                if (i < firstDayIndex) {
                    // Prev Month
                    cell.classList.add('other-month');
                    const dayNum = prevMonthDays - firstDayIndex + i + 1;
                    cell.innerText = dayNum;
                    const pm = month === 0 ? 11 : month - 1;
                    const py = month === 0 ? year - 1 : year;
                    cellDateStr = formatDate(py, pm, dayNum);
                } else if (i >= firstDayIndex + daysInMonth) {
                    // Next Month
                    cell.classList.add('other-month');
                    const dayNum = i - (firstDayIndex + daysInMonth) + 1;
                    cell.innerText = dayNum;
                    const nm = month === 11 ? 0 : month + 1;
                    const ny = month === 11 ? year + 1 : year;
                    cellDateStr = formatDate(ny, nm, dayNum);
                } else {
                    // Current Month
                    const dayNum = i - firstDayIndex + 1;
                    cell.innerHTML = `<div class="day-number">${dayNum}</div>`;
                    cellDateStr = formatDate(year, month, dayNum);
                    renderEventsInCell(cell, cellDateStr);
                }
                
                cell.addEventListener('click', () => openEventModal(cellDateStr));
                calendarGrid.appendChild(cell);
            }
        }

        // --- 2. WEEK VIEW RENDERER ---
        function renderWeekView() {
            calendarGrid.innerHTML = '';
            calendarHeaders.innerHTML = '';
            calendarGrid.style.gridTemplateColumns = 'repeat(7, 1fr)';
            calendarHeaders.style.gridTemplateColumns = 'repeat(7, 1fr)';

            // Calculate start of week (Sunday)
            const startOfWeek = new Date(navDate);
            startOfWeek.setDate(navDate.getDate() - navDate.getDay());

            // Update Title: "Nov 12 - Nov 18, 2025"
            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setDate(startOfWeek.getDate() + 6);
            currentDateDisplay.innerText = `${startOfWeek.toLocaleDateString()} - ${endOfWeek.toLocaleDateString()}`;

            // Loop 7 days
            for (let i = 0; i < 7; i++) {
                const currentDay = new Date(startOfWeek);
                currentDay.setDate(startOfWeek.getDate() + i);
                const dateStr = formatDate(currentDay.getFullYear(), currentDay.getMonth(), currentDay.getDate());

                // Header: "Sun 11/12"
                calendarHeaders.innerHTML += `<div class="day-header">${currentDay.toLocaleDateString('en-US', {weekday:'short', month:'numeric', day:'numeric'})}</div>`;

                // Cell
                const cell = document.createElement('div');
                cell.className = 'day-cell';
                renderEventsInCell(cell, dateStr);
                cell.addEventListener('click', () => openEventModal(dateStr));
                calendarGrid.appendChild(cell);
            }
        }

        // --- 3. DAY VIEW RENDERER ---
        function renderDayView() {
            calendarGrid.innerHTML = '';
            calendarHeaders.innerHTML = '';
            // Single Column Layout
            calendarGrid.style.gridTemplateColumns = '1fr';
            calendarHeaders.style.gridTemplateColumns = '1fr';

            const dateStr = formatDate(navDate.getFullYear(), navDate.getMonth(), navDate.getDate());
            
            currentDateDisplay.innerText = navDate.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' });
            
            // Header
            calendarHeaders.innerHTML = `<div class="day-header">Schedule</div>`;

            // Single Cell
            const cell = document.createElement('div');
            cell.className = 'day-cell';
            renderEventsInCell(cell, dateStr);
            cell.addEventListener('click', () => openEventModal(dateStr));
            calendarGrid.appendChild(cell);
        }

        // --- HELPER: Render Events inside a cell ---
        function renderEventsInCell(cellElement, dateStr) {
            const eventsForDay = events.filter(e => e.date === dateStr);
            eventsForDay.forEach(event => {
                const eventEl = document.createElement('div');
                eventEl.className = `event event-${event.type}`;
                // Show time if it's a shift
                const timeText = event.startTime ? ` (${event.startTime}-${event.endTime})` : '';
                eventEl.innerText = `${event.name}${timeText}`;
                
                eventEl.addEventListener('click', (e) => {
                    e.stopPropagation();
                    openEventModal(dateStr, event.id);
                });
                cellElement.appendChild(eventEl);
            });
        }

        // --- HELPER: Format Date consistently (YYYY-MM-DD) ---
        function formatDate(year, month, day) {
            return `${year}-${String(month + 1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
        }

        // --- NAVIGATION (Prev/Next) ---
        document.getElementById('prevBtn').addEventListener('click', () => {
            if(currentView === 'month') navDate.setMonth(navDate.getMonth() - 1);
            else if(currentView === 'week') navDate.setDate(navDate.getDate() - 7);
            else navDate.setDate(navDate.getDate() - 1);
            render();
        });

        document.getElementById('nextBtn').addEventListener('click', () => {
            if(currentView === 'month') navDate.setMonth(navDate.getMonth() + 1);
            else if(currentView === 'week') navDate.setDate(navDate.getDate() + 7);
            else navDate.setDate(navDate.getDate() + 1);
            render();
        });

        // --- ASSOCIATE MANAGEMENT LOGIC ---
        document.getElementById('btnManageAssociates').addEventListener('click', () => {
            associateModal.style.display = 'flex';
            renderAssociatesList();
        });

        document.getElementById('closeAssociateBtn').addEventListener('click', () => {
            associateModal.style.display = 'none';
        });

        document.getElementById('btnAddAssociate').addEventListener('click', () => {
            const name = newAssociateInput.value.trim();
            if (name && !associates.includes(name)) {
                associates.push(name);
                newAssociateInput.value = '';
                renderAssociatesList();
                renderAssociates(); // Update main dropdown
            }
        });

        function renderAssociatesList() {
            associateListEl.innerHTML = '';
            associates.forEach(name => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <span>${name}</span>
                    <button class="btn-sm-delete" onclick="removeAssociate('${name}')">Remove</button>
                `;
                associateListEl.appendChild(li);
            });
        }

        // Needs to be global to be called from onclick in HTML
        window.removeAssociate = function(name) {
            if(confirm(`Remove ${name} from the team?`)) {
                associates = associates.filter(a => a !== name);
                renderAssociatesList();
                renderAssociates(); // Update main dropdown
            }
        };

        function renderAssociates() {
            // Populate the dropdown in the Event Modal
            associateSelect.innerHTML = '';
            associates.forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                associateSelect.appendChild(option);
            });
        }

        // --- EVENT MODAL LOGIC ---
        function openEventModal(dateStr, eventId = null) {
            eventModal.style.display = 'flex';
            document.getElementById('eventDate').value = dateStr;
            
            if (eventId) {
                currentlyEditingEventId = eventId;
                document.getElementById('modalTitle').innerText = 'Edit Schedule';
                document.getElementById('deleteBtn').style.display = 'block';
                const event = events.find(e => e.id === eventId);
                associateSelect.value = event.name;
                document.getElementById('eventType').value = event.type;
                document.getElementById('startTime').value = event.startTime;
                document.getElementById('endTime').value = event.endTime;
            } else {
                currentlyEditingEventId = null;
                document.getElementById('modalTitle').innerText = 'Add Schedule';
                document.getElementById('deleteBtn').style.display = 'none';
                eventForm.reset();
                // Ensure associate select defaults to first option
                if(associates.length > 0) associateSelect.value = associates[0];
            }
            toggleTimeFields();
        }

        document.getElementById('cancelBtn').addEventListener('click', () => eventModal.style.display = 'none');
        
        document.getElementById('eventType').addEventListener('change', toggleTimeFields);
        function toggleTimeFields() {
            const type = document.getElementById('eventType').value;
            document.getElementById('timeFields').style.display = (type === 'shift') ? 'block' : 'none';
        }

        eventForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const eventData = {
                id: currentlyEditingEventId || Date.now().toString(),
                date: document.getElementById('eventDate').value,
                name: associateSelect.value, // Gets value from Dropdown
                type: document.getElementById('eventType').value,
                startTime: document.getElementById('startTime').value,
                endTime: document.getElementById('endTime').value
            };

            if (currentlyEditingEventId) {
                events = events.map(e => e.id === currentlyEditingEventId ? eventData : e);
            } else {
                events.push(eventData);
            }
            eventModal.style.display = 'none';
            render();
        });

        document.getElementById('deleteBtn').addEventListener('click', () => {
            if (currentlyEditingEventId) {
                events = events.filter(e => e.id !== currentlyEditingEventId);
                eventModal.style.display = 'none';
                render();
            }
        });

        // START APP
        init();

    </script>
</body>
</html>